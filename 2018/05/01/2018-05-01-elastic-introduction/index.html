<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Erichain"><title>Elasticsearch 简介 · Erichain's Causeries</title><meta name="description" content="什么是 ElasticsearchElasticsearch 是一个实时的分布式搜索分析引擎， 它能让你以一个之前从未有过的速度和规模，去探索你的数据。
Elasticsearch 中，并没有特别革命性的组件，其革命性的地方在于，它将这些单独的组件融合到了一个单一的，一致的，实时的应用中。
为什么要"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/avatar.jpg" style="width:127px;"><h3 title=""><a href="/">Erichain's Causeries</a></h3><div class="description"><p>Everything about Erichain, including blogs, portfolio, projects and life etc.</p></div></div></div><ul class="social-links"><li><a href="http://weibo.com/2246924895"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/Erichain"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/avatar.jpg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Elasticsearch 简介</a></h3></div><div class="post-content"><h3 id="什么是-Elasticsearch"><a href="#什么是-Elasticsearch" class="headerlink" title="什么是 Elasticsearch"></a>什么是 Elasticsearch</h3><p>Elasticsearch 是一个实时的分布式搜索分析引擎， 它能让你以一个之前从未有过的速度和规模，去探索你的数据。</p>
<p>Elasticsearch 中，并没有特别革命性的组件，其革命性的地方在于，它将这些单独的组件融合到了一个单一的，一致的，实时的应用中。</p>
<h3 id="为什么要使用-Elasticsearch"><a href="#为什么要使用-Elasticsearch" class="headerlink" title="为什么要使用 Elasticsearch"></a>为什么要使用 Elasticsearch</h3><p>Elasticsearch 鼓励探索与利用数据，而不是因为查询数据太困难就让数据烂在数据库中。</p>
<p>可以这样描述 Elasticsearch：</p>
<ul>
<li>一个分布式的实时文档存储，每个字段都可以被索引与搜索</li>
<li>一个分布式的实时分析搜索引擎</li>
<li>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据</li>
</ul>
<h3 id="Elasticsearch-的特性"><a href="#Elasticsearch-的特性" class="headerlink" title="Elasticsearch 的特性"></a>Elasticsearch 的特性</h3><p>Elasticsearch 尽可能地屏蔽了分布式系统的复杂性。这里列举了一些在后台自动执行的操作：</p>
<ul>
<li>分配文档到不同的容器或分片中，文档可以储存在一个或多个节点中</li>
<li>按集群节点来均衡分配这些分片，从而对索引和搜索过程进行负载均衡</li>
<li>复制每个分片以支持数据冗余，从而防止硬件故障导致的数据丢失</li>
<li>将集群中任一节点的请求路由到存有相关数据的节点</li>
<li>集群扩容时无缝整合新节点，重新分配分片以便从离群节点恢复</li>
</ul>
<h3 id="如何与-Elasticsearch-进行交互"><a href="#如何与-Elasticsearch-进行交互" class="headerlink" title="如何与 Elasticsearch 进行交互"></a>如何与 Elasticsearch 进行交互</h3><p>如果采用非 Java 语言作为客户端，Elasticsearch 则采用 RESTful API 加上 JSON 来进行交互。</p>
<blockquote>
<p>此处我们以 Node 为例。</p>
</blockquote>
<p>下载好了官方所提供的 Elasticsearch 的<a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="external">安装包</a>之后，使用 <code>./bin/elasticsearch</code> 来启动 Elasticsearch 服务。这样，就可以通过客户端来对其进行搜索了。</p>
<p>一开始 Elasticsearch 并没有提供特别多的数据给我们进行查询。当我们直接请求 <code>http://localhost:9200</code> 的时候，返回的是这样的一段 JSON：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"LvaJrMJ"</span>,</div><div class="line">  <span class="attr">"cluster_name"</span>: <span class="string">"elasticsearch"</span>,</div><div class="line">  <span class="attr">"cluster_uuid"</span>: <span class="string">"x7LaqCn_TfSjS1O3cPmYrQ"</span>,</div><div class="line">  <span class="attr">"version"</span>: &#123;</div><div class="line">    <span class="attr">"number"</span>: <span class="string">"6.2.4"</span>,</div><div class="line">    <span class="attr">"build_hash"</span>: <span class="string">"ccec39f"</span>,</div><div class="line">    <span class="attr">"build_date"</span>: <span class="string">"2018-04-12T20:37:28.497551Z"</span>,</div><div class="line">    <span class="attr">"build_snapshot"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"lucene_version"</span>: <span class="string">"7.2.1"</span>,</div><div class="line">    <span class="attr">"minimum_wire_compatibility_version"</span>: <span class="string">"5.6.0"</span>,</div><div class="line">    <span class="attr">"minimum_index_compatibility_version"</span>: <span class="string">"5.0.0"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"tagline"</span>: <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段 JSON 只是描述了 Elasticsearch 的集群信息和版本信息，并没有我们想要的数据。如果我们要查询数据，那么，就需要将请求地址改为 <code>http://localhost:9200/_search</code>，这样，我们获取到的 JSON 就是下面这样：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"took"</span>: <span class="number">63</span>,</div><div class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">"_shards"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"successful"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"hits"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"max_score"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"hits"</span>: []</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所以，我们就能够看出来，现在我们的 Elasticsearch 中还没有数据可供搜索，我们需要为其添加一些数据进去。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 此处我们采用 faker 来生成随机数据</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> requests = [];</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">    faker.seed(<span class="number">30</span>);</div><div class="line">    requests.push(</div><div class="line">	  <span class="comment">// 存储的地址为 http://localhost:9200/megacorp/employee/id</span></div><div class="line">      axios.put(<span class="string">`http://localhost:9200/megacorp/employee/<span class="subst">$&#123;i&#125;</span>`</span>, &#123;</div><div class="line">        <span class="attr">first_name</span>: faker.name.firstName(),</div><div class="line">        <span class="attr">last_name</span>: faker.name.lastName(),</div><div class="line">        <span class="attr">age</span>: faker.random.number(&#123;</div><div class="line">          <span class="attr">min</span>: <span class="number">20</span>,</div><div class="line">          <span class="attr">max</span>: <span class="number">50</span>,</div><div class="line">        &#125;),</div><div class="line">        <span class="attr">jobType</span>: faker.name.jobType(),</div><div class="line">        <span class="attr">interests</span>: [faker.lorem.word(), faker.lorem.word()],</div><div class="line">      &#125;)</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.all(requests);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样，我们就初始化了十条数据到我们的数据库中去了。现在，我们就可以对这些数据进行搜索了。</p>
<h4 id="根据-id-来搜索"><a href="#根据-id-来搜索" class="headerlink" title="根据 id 来搜索"></a>根据 id 来搜索</h4><blockquote>
<p>由于我们采用了 faker 来生成随机数据，所以，如果每次修改了代码并重启了 Node 服务的话，每一次获取的数据可能是不一样的。</p>
</blockquote>
<p>按照 RESTful API 的格式，我们如果要根据 id 来搜索我们的数据，只需要在 URL 上带上 id 就行了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">axios.get(<span class="string">'http://localhost:9200/megacorp/employee/1'</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data.data, <span class="literal">null</span>, <span class="number">2</span>))</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>获取到的数据如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"_index"</span>: <span class="string">"megacorp"</span>,</div><div class="line">  <span class="attr">"_type"</span>: <span class="string">"employee"</span>,</div><div class="line">  <span class="attr">"_id"</span>: <span class="string">"1"</span>,</div><div class="line">  <span class="attr">"_version"</span>: <span class="number">31</span>,</div><div class="line">  <span class="attr">"found"</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">"_source"</span>: &#123;</div><div class="line">    <span class="attr">"first_name"</span>: <span class="string">"Luigi"</span>,</div><div class="line">    <span class="attr">"last_name"</span>: <span class="string">"Von"</span>,</div><div class="line">    <span class="attr">"age"</span>: <span class="number">31</span>,</div><div class="line">    <span class="attr">"jobType"</span>: <span class="string">"Manager"</span>,</div><div class="line">    <span class="attr">"interests"</span>: [</div><div class="line">      <span class="string">"nam"</span>,</div><div class="line">      <span class="string">"voluptate"</span></div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果我们要获取到所有的数据，那么只需要将请求的 URL 修改为 <code>http://localhost:9200/megacorp/employee/_search</code> 就可以了。</p>
<h4 id="根据-query-string-来搜索"><a href="#根据-query-string-来搜索" class="headerlink" title="根据 query-string 来搜索"></a>根据 query-string 来搜索</h4><p>现在，我们通过一个查询字符串（query-string）来进行搜索。比如，我们要搜索 first_name 为 Hailee 的员工：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">axios.get(<span class="string">'http://localhost:9200/megacorp/employee/_search?q=first_name:Hailee'</span>)</div></pre></td></tr></table></figure>
<p>获取到的数据如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"took"</span>: <span class="number">5</span>,</div><div class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">"_shards"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"hits"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">"max_score"</span>: <span class="number">0.9808292</span>,</div><div class="line">    <span class="attr">"hits"</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"_index"</span>: <span class="string">"megacorp"</span>,</div><div class="line">        <span class="attr">"_type"</span>: <span class="string">"employee"</span>,</div><div class="line">        <span class="attr">"_id"</span>: <span class="string">"5"</span>,</div><div class="line">        <span class="attr">"_score"</span>: <span class="number">0.9808292</span>,</div><div class="line">        <span class="attr">"_source"</span>: &#123;</div><div class="line">          <span class="attr">"first_name"</span>: <span class="string">"Hailee"</span>,</div><div class="line">          <span class="attr">"last_name"</span>: <span class="string">"Donnelly"</span>,</div><div class="line">          <span class="attr">"age"</span>: <span class="number">45</span>,</div><div class="line">          <span class="attr">"jobType"</span>: <span class="string">"Liaison"</span>,</div><div class="line">          <span class="attr">"interests"</span>: [</div><div class="line">            <span class="string">"adipisci"</span>,</div><div class="line">            <span class="string">"nesciunt"</span></div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同理，如果要用其他的字段进行查询，请求的格式也是一样的。</p>
<h4 id="使用-DSL-进行查询"><a href="#使用-DSL-进行查询" class="headerlink" title="使用 DSL 进行查询"></a>使用 DSL 进行查询</h4><p>DSL 即领域特定语言。Elasticsearch 提供了一个丰富灵活的查询语言叫做查询表达式，它支持构建更加复杂和健壮的查询。</p>
<p>比如，我们依然要查询 first_name 为 Hailee 的员工，使用 DSL 的话可以像这样写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> queryBody = &#123;</div><div class="line">  <span class="attr">query</span>: &#123;</div><div class="line">    <span class="attr">match</span>: &#123;</div><div class="line">      <span class="attr">first_name</span>: <span class="string">'Hailee'</span>,</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">axios.get(<span class="string">'http://localhost:9200/megacorp/employee/_search'</span>, &#123;</div><div class="line">    <span class="attr">params</span>: &#123;</div><div class="line">	  <span class="comment">// 如果采用第三方库来请求的话，需要加上 source 和 source_content_type 字段</span></div><div class="line">	  <span class="comment">// 详见 https://www.elastic.co/guide/en/elasticsearch/reference/current/common-options.html#_request_body_in_query_string</span></div><div class="line">      source: <span class="built_in">JSON</span>.stringify(queryBody),</div><div class="line">      <span class="attr">source_content_type</span>: <span class="string">'application/json'</span></div><div class="line">    &#125;,</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<h4 id="使用-DSL-进行更复杂的查询"><a href="#使用-DSL-进行更复杂的查询" class="headerlink" title="使用 DSL 进行更复杂的查询"></a>使用 DSL 进行更复杂的查询</h4><p>我们现在尝试进行一些复杂的查询，比如，我们要查询 jobType 为 Designer 并且 age 大于 40 的员工。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> queryBody = &#123;</div><div class="line">  <span class="attr">query</span>: &#123;</div><div class="line">    <span class="attr">bool</span>: &#123;</div><div class="line">      <span class="attr">must</span>: &#123;</div><div class="line">        <span class="attr">match</span>: &#123;</div><div class="line">          <span class="attr">jobType</span>: <span class="string">'Designer'</span>,</div><div class="line">        &#125;,</div><div class="line">      &#125;,</div><div class="line">      <span class="attr">filter</span>: &#123;</div><div class="line">        <span class="attr">range</span>: &#123;</div><div class="line">          <span class="attr">age</span>: &#123;</div><div class="line">	        <span class="comment">// gt 即 greater than</span></div><div class="line">            gt: <span class="number">40</span>,</div><div class="line">          &#125;,</div><div class="line">        &#125;,</div><div class="line">      &#125;,</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">axios.get(<span class="string">'http://localhost:9200/megacorp/employee/_search'</span>, &#123;</div><div class="line">  <span class="attr">params</span>: &#123;</div><div class="line">    <span class="attr">source</span>: <span class="built_in">JSON</span>.stringify(queryBody),</div><div class="line">    <span class="attr">source_content_type</span>: <span class="string">'application/json'</span></div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这样，我们查询到的结果如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"took"</span>: <span class="number">3</span>,</div><div class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">"_shards"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"hits"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">"max_score"</span>: <span class="number">0.6931472</span>,</div><div class="line">    <span class="attr">"hits"</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"_index"</span>: <span class="string">"megacorp"</span>,</div><div class="line">        <span class="attr">"_type"</span>: <span class="string">"employee"</span>,</div><div class="line">        <span class="attr">"_id"</span>: <span class="string">"1"</span>,</div><div class="line">        <span class="attr">"_score"</span>: <span class="number">0.6931472</span>,</div><div class="line">        <span class="attr">"_source"</span>: &#123;</div><div class="line">          <span class="attr">"first_name"</span>: <span class="string">"Oceane"</span>,</div><div class="line">          <span class="attr">"last_name"</span>: <span class="string">"Boyer"</span>,</div><div class="line">          <span class="attr">"age"</span>: <span class="number">44</span>,</div><div class="line">          <span class="attr">"jobType"</span>: <span class="string">"Designer"</span>,</div><div class="line">          <span class="attr">"interests"</span>: [</div><div class="line">            <span class="string">"tenetur"</span>,</div><div class="line">            <span class="string">"non"</span></div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h4><p>现在，我们再来试试全文搜索，我们要查询 jobDescriptor 中包含 <code>Quidem et</code> 的员工：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> queryBody = &#123;</div><div class="line">  <span class="attr">query</span>: &#123;</div><div class="line">    <span class="attr">match</span>: &#123;</div><div class="line">      <span class="attr">jobDescriptor</span>: <span class="string">'Quidem et'</span>,</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">axios.get(<span class="string">'http://localhost:9200/megacorp/employee/_search'</span>, &#123;</div><div class="line">  <span class="attr">params</span>: &#123;</div><div class="line">    <span class="attr">source</span>: <span class="built_in">JSON</span>.stringify(queryBody),</div><div class="line">    <span class="attr">source_content_type</span>: <span class="string">'application/json'</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这样返回来的结果如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"took"</span>: <span class="number">18</span>,</div><div class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">"_shards"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"hits"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">3</span>,</div><div class="line">    <span class="attr">"max_score"</span>: <span class="number">1.6799116</span>,</div><div class="line">    <span class="attr">"hits"</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"_index"</span>: <span class="string">"megacorp"</span>,</div><div class="line">        <span class="attr">"_type"</span>: <span class="string">"employee"</span>,</div><div class="line">        <span class="attr">"_id"</span>: <span class="string">"9"</span>,</div><div class="line">        <span class="attr">"_score"</span>: <span class="number">1.6799116</span>,</div><div class="line">        <span class="attr">"_source"</span>: &#123;</div><div class="line">          <span class="attr">"first_name"</span>: <span class="string">"Melody"</span>,</div><div class="line">          <span class="attr">"last_name"</span>: <span class="string">"White"</span>,</div><div class="line">          <span class="attr">"age"</span>: <span class="number">38</span>,</div><div class="line">          <span class="attr">"jobType"</span>: <span class="string">"Planner"</span>,</div><div class="line">          <span class="attr">"jobDescriptor"</span>: <span class="string">"Quidem et officiis at."</span>,</div><div class="line">          <span class="attr">"interests"</span>: [</div><div class="line">            <span class="string">"dolorem"</span>,</div><div class="line">            <span class="string">"et"</span></div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"_index"</span>: <span class="string">"megacorp"</span>,</div><div class="line">        <span class="attr">"_type"</span>: <span class="string">"employee"</span>,</div><div class="line">        <span class="attr">"_id"</span>: <span class="string">"5"</span>,</div><div class="line">        <span class="attr">"_score"</span>: <span class="number">0.44000342</span>,</div><div class="line">        <span class="attr">"_source"</span>: &#123;</div><div class="line">          <span class="attr">"first_name"</span>: <span class="string">"Leanna"</span>,</div><div class="line">          <span class="attr">"last_name"</span>: <span class="string">"Kunze"</span>,</div><div class="line">          <span class="attr">"age"</span>: <span class="number">47</span>,</div><div class="line">          <span class="attr">"jobType"</span>: <span class="string">"Officer"</span>,</div><div class="line">          <span class="attr">"jobDescriptor"</span>: <span class="string">"Enim praesentium suscipit et laboriosam placeat qui."</span>,</div><div class="line">          <span class="attr">"interests"</span>: [</div><div class="line">            <span class="string">"quia"</span>,</div><div class="line">            <span class="string">"ab"</span></div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"_index"</span>: <span class="string">"megacorp"</span>,</div><div class="line">        <span class="attr">"_type"</span>: <span class="string">"employee"</span>,</div><div class="line">        <span class="attr">"_id"</span>: <span class="string">"3"</span>,</div><div class="line">        <span class="attr">"_score"</span>: <span class="number">0.2876821</span>,</div><div class="line">        <span class="attr">"_source"</span>: &#123;</div><div class="line">          <span class="attr">"first_name"</span>: <span class="string">"Carolina"</span>,</div><div class="line">          <span class="attr">"last_name"</span>: <span class="string">"Harris"</span>,</div><div class="line">          <span class="attr">"age"</span>: <span class="number">20</span>,</div><div class="line">          <span class="attr">"jobType"</span>: <span class="string">"Designer"</span>,</div><div class="line">          <span class="attr">"jobDescriptor"</span>: <span class="string">"Fugiat fuga asperiores reiciendis aperiam tempore totam voluptatem et."</span>,</div><div class="line">          <span class="attr">"interests"</span>: [</div><div class="line">            <span class="string">"odio"</span>,</div><div class="line">            <span class="string">"aut"</span></div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们可以看到，返回来有三条数据，但是只有第一条是包含了 <code>Quidem et</code> 的。另外两条数据的 jobDescriptor 中包含有 <code>et</code> 字符，所以也给返回回来的。同时，Elasticsearch 帮助我们做了一个相关性评分，即 <code>_score</code> 字段。第一条数据评分最高，依次往下逐渐降低。</p>
<p>那么，如果我们想要完全匹配一个短语怎么办呢？当然有办法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> queryBody = &#123;</div><div class="line">  <span class="attr">query</span>: &#123;</div><div class="line">    <span class="attr">match_phrase</span>: &#123;</div><div class="line">      <span class="attr">jobDescriptor</span>: <span class="string">'Quidem et'</span>,</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">axios.get(<span class="string">'http://localhost:9200/megacorp/employee/_search'</span>, &#123;</div><div class="line">  <span class="attr">params</span>: &#123;</div><div class="line">    <span class="attr">source</span>: <span class="built_in">JSON</span>.stringify(queryBody),</div><div class="line">    <span class="attr">source_content_type</span>: <span class="string">'application/json'</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这样，返回的数据就只有一条了：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"took"</span>: <span class="number">12</span>,</div><div class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">"_shards"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"hits"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">"max_score"</span>: <span class="number">1.6799116</span>,</div><div class="line">    <span class="attr">"hits"</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"_index"</span>: <span class="string">"megacorp"</span>,</div><div class="line">        <span class="attr">"_type"</span>: <span class="string">"employee"</span>,</div><div class="line">        <span class="attr">"_id"</span>: <span class="string">"9"</span>,</div><div class="line">        <span class="attr">"_score"</span>: <span class="number">1.6799116</span>,</div><div class="line">        <span class="attr">"_source"</span>: &#123;</div><div class="line">          <span class="attr">"first_name"</span>: <span class="string">"Melody"</span>,</div><div class="line">          <span class="attr">"last_name"</span>: <span class="string">"White"</span>,</div><div class="line">          <span class="attr">"age"</span>: <span class="number">38</span>,</div><div class="line">          <span class="attr">"jobType"</span>: <span class="string">"Planner"</span>,</div><div class="line">          <span class="attr">"jobDescriptor"</span>: <span class="string">"Quidem et officiis at."</span>,</div><div class="line">          <span class="attr">"interests"</span>: [</div><div class="line">            <span class="string">"dolorem"</span>,</div><div class="line">            <span class="string">"et"</span></div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="高亮搜索（highlight）"><a href="#高亮搜索（highlight）" class="headerlink" title="高亮搜索（highlight）"></a>高亮搜索（highlight）</h4><p>如果需要在结果中高亮搜索的片段，只需要在查询参数中添加 <code>highlight</code> 参数就可以了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> queryBody = &#123;</div><div class="line">  <span class="attr">query</span>: &#123;</div><div class="line">    <span class="attr">match_phrase</span>: &#123;</div><div class="line">      <span class="attr">jobDescriptor</span>: <span class="string">'Quidem et'</span>,</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">highlight</span>: &#123;</div><div class="line">    <span class="attr">fields</span>: &#123;</div><div class="line">      <span class="attr">jobDescriptor</span>: &#123;&#125;,</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">axios.get(<span class="string">'http://localhost:9200/megacorp/employee/_search'</span>, &#123;</div><div class="line">  <span class="attr">params</span>: &#123;</div><div class="line">    <span class="attr">source</span>: <span class="built_in">JSON</span>.stringify(queryBody),</div><div class="line">    <span class="attr">source_content_type</span>: <span class="string">'application/json'</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>以下是返回结果，同样的会有一个 highlight 字段：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"took"</span>: <span class="number">374</span>,</div><div class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">"_shards"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"hits"</span>: &#123;</div><div class="line">    <span class="attr">"total"</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">"max_score"</span>: <span class="number">1.6799116</span>,</div><div class="line">    <span class="attr">"hits"</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"_index"</span>: <span class="string">"megacorp"</span>,</div><div class="line">        <span class="attr">"_type"</span>: <span class="string">"employee"</span>,</div><div class="line">        <span class="attr">"_id"</span>: <span class="string">"9"</span>,</div><div class="line">        <span class="attr">"_score"</span>: <span class="number">1.6799116</span>,</div><div class="line">        <span class="attr">"_source"</span>: &#123;</div><div class="line">          <span class="attr">"first_name"</span>: <span class="string">"Melody"</span>,</div><div class="line">          <span class="attr">"last_name"</span>: <span class="string">"White"</span>,</div><div class="line">          <span class="attr">"age"</span>: <span class="number">38</span>,</div><div class="line">          <span class="attr">"jobType"</span>: <span class="string">"Planner"</span>,</div><div class="line">          <span class="attr">"jobDescriptor"</span>: <span class="string">"Quidem et officiis at."</span>,</div><div class="line">          <span class="attr">"interests"</span>: [</div><div class="line">            <span class="string">"dolorem"</span>,</div><div class="line">            <span class="string">"et"</span></div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"highlight"</span>: &#123;</div><div class="line">          <span class="attr">"jobDescriptor"</span>: [</div><div class="line">            <span class="string">"&lt;em&gt;Quidem&lt;/em&gt; &lt;em&gt;et&lt;/em&gt; officiis at."</span></div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="聚合（Aggregations）"><a href="#聚合（Aggregations）" class="headerlink" title="聚合（Aggregations）"></a>聚合（Aggregations）</h4><p>Elasticsearch 允许我们基于数据生成一些精细的分析结果。类似于将信息分组。</p>
<p>比如，我们要分析员工目录中的职位类别：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> queryBody = &#123;</div><div class="line">  <span class="attr">aggs</span>: &#123;</div><div class="line">    <span class="attr">all_job_types</span>: &#123;</div><div class="line">      <span class="attr">terms</span>: &#123;</div><div class="line">        <span class="attr">field</span>: <span class="string">'jobType'</span></div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">axios.get(<span class="string">'http://localhost:9200/megacorp/employee/_search'</span>, &#123;</div><div class="line">  <span class="attr">params</span>: &#123;</div><div class="line">    <span class="attr">source</span>: <span class="built_in">JSON</span>.stringify(queryBody),</div><div class="line">    <span class="attr">source_content_type</span>: <span class="string">'application/json'</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<blockquote>
<p>此处，在请求的时候，可能会遇到 <code>java.lang.IllegalArgumentException: Fielddata is disabled on text fields by default. Set fielddata=true on [jobType] in order to load fielddata in memory by uninverting the inverted index</code> 这样的错误。这时候，需要在客户端加上一个请求来设置 <code>fielddata</code>。<br>详见 <a href="https://stackoverflow.com/questions/38145991/how-to-set-fielddata-true-in-kibana" target="_blank" rel="external">https://stackoverflow.com/questions/38145991/how-to-set-fielddata-true-in-kibana</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置 fielddata</span></div><div class="line">axios.put(<span class="string">'http://localhost:9200/megacorp/_mapping/employee'</span>, &#123;</div><div class="line">  <span class="attr">employee</span>: &#123;</div><div class="line">    <span class="attr">properties</span>: &#123;</div><div class="line">      <span class="attr">jobType</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="string">'text'</span>,</div><div class="line">        <span class="attr">fielddata</span>: <span class="literal">true</span>,</div><div class="line">      &#125;,</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这样，我们查询出来的数据就会有下面这样的字段：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">"aggregations": &#123;</div><div class="line">  "all_job_types": &#123;</div><div class="line">    "doc_count_error_upper_bound": 0,</div><div class="line">    "sum_other_doc_count": 0,</div><div class="line">    "buckets": [</div><div class="line">      &#123;</div><div class="line">        "key": "assistant",</div><div class="line">        "doc_count": 2</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        "key": "orchestrator",</div><div class="line">        "doc_count": 2</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        "key": "associate",</div><div class="line">        "doc_count": 1</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        "key": "designer",</div><div class="line">        "doc_count": 1</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        "key": "developer",</div><div class="line">        "doc_count": 1</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        "key": "facilitator",</div><div class="line">        "doc_count": 1</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        "key": "planner",</div><div class="line">        "doc_count": 1</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        "key": "technician",</div><div class="line">        "doc_count": 1</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>以上是直接使用前端的 ajax 请求来发送参数进行查询。Elasticsearch 为我们提供了一个官方的 <a href="https://github.com/elastic/elasticsearch-js" target="_blank" rel="external">easticsearch.js</a>，以便我们能够更加方便的对数据进行查询。</p>
<p>本文中的完整代码地址：<a href="https://github.com/Erichain/elasticsearch-with-koa" target="_blank" rel="external">https://github.com/Erichain/elasticsearch-with-koa</a></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html" target="_blank" rel="external">Elasticsearch: 权威指南</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-05-01</span><i class="fa fa-tag"></i><a href="/categories/Elasticsearch/" title="Elasticsearch" class="tag">Elasticsearch </a><a href="/tags/elasticsearch/" title="elasticsearch" class="tag">elasticsearch </a><a href="/tags/koa/" title="koa" class="tag">koa </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,https://erichain.me/2018/05/01/2018-05-01-elastic-introduction/,Erichain's Causeries,Elasticsearch 简介,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2017/09/26/2017-09-26-talk-about-iterator-pattern/" title="谈谈设计模式 —— Iterator" class="btn">上一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>